# LVM虚拟机内部数据类型

本文档将会描述LVM虚拟机内部使用的所有数据类型。请注意，LVM虚拟机内部的数据类型和在其之上运行的高级语言的数据类型并不相同，请不要将它们混淆。

LVM在任何时候，任何操作系统下，都将使用*大端序*进行数据存取。LVM对所有内存空间都将进行8位字节对齐处理，以简化内部处理和提升性能。

LVM内部有四类数据类型，分别为：整数类型，浮点类型，布尔类型，引用类型。

以下描述的数据类型都不一定在其上层语言中有对应的数据类型，但是LVM对其提供了相应的支持以满足可能出现的需求。

关于以下数据类型的具体操作，将在LVM字节码指令集中详细描述。

## 整数类型

整数类型都表示一个整数，但由于占用内存空间不同，LVM把它们分为5种。

1. byte: 8位有符号二进制补码整数，默认值为`0`。
2. short: 16位有符号二进制补码整数，默认值为`0`。
3. integer: 32位有符号二进制补码整数，默认值为`0`。
4. long: 64位有符号二进制补码整数，默认值为`0`。
5. char: 16位无符号整数，对应*基本多文种平面*的Unicode码点，以`UTF-16`编码，默认值为Unicode的`null`码点（`'\u0000'`)。

它们的数据范围如下：

1. byte: [-128, 127] ([-2^7, 2^7-1])
2. short: [-32,768, 32,767] ([-2^15, 2^15-1])
3. integer: [-2,147,483,648, 2,147,483,647] ([-2^31, 2^31-1])
4. long: [-9,223,372,036,854,775,808, 9,223,372,036,854,775,807] ([-2^63, 2^63-1])
5. char: [0, 65,535]

开发人员资料：

- [二进制补码](https://zh.wikipedia.org/wiki/%E4%BA%8C%E8%A3%9C%E6%95%B8)
- [UTF-16](https://zh.wikipedia.org/wiki/UTF-16)
- [Unicode字符平面映射](https://zh.wikipedia.org/wiki/Unicode%E5%AD%97%E7%AC%A6%E5%B9%B3%E9%9D%A2%E6%98%A0%E5%B0%84)

## 浮点类型

浮点类型都表示一个浮点数，LVM包括两种浮点类型：

1. float: 32位单精度浮点数，默认值为`+0`。
2. double: 64位双精度浮点数，默认值为`+0`。

LVM浮点数的实现需要遵守IEEE 754标准的所有规定，包括存储方式、基本运算和异常情况等。

开发人员资料：

- [维基百科上的IEEE 754描述](https://zh.wikipedia.org/wiki/IEEE_754)
- [IEEE 754标准参考文献](https://web.archive.org/web/20070505021348/http://babbage.cs.qc.edu/courses/cs341/IEEE-754references.html)
- [IEEE 754标准中的详尽的数学原理与某些实现方式](https://docs.oracle.com/cd/E19957-01/806-3568/ncg_goldberg.html)

## 布尔类型

布尔类型（`boolean`）是一种特殊的整数类型，它仅用于储存`1`或`0`（`true`或`false`）。

在LVM中，boolean类型将被当作integer类型实现，boolean类型的数组将被当作byte类型实现，LVM不会提供任何boolean类型专用的字节码指令。

## 引用类型

引用类型（`reference`）表示*堆内存*中的某个位置。reference类型仅存在于LVM内部，不应在上层语言中出现直接的数据类型映射。reference类型与上层语言中可能出现的指针或引用类型没有任何直接联系。

reference将会被实现为一个64位无符号整数，用以支持足够大的堆内存空间的检索。

`null`为reference类型的默认值，在内部以无符号数`0`表示，代表此引用不指向任何实际的内存空间。

LVM对数组的访问，结构体的访问，常量的访问等都将使用reference实现，具体操作将会在LVM字节码指令集中描述。